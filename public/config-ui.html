<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Bookmarklet Configuration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .config-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .provider-card {
            border: 2px solid #e1e5e9;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .provider-card.active {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        .provider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .provider-name {
            font-weight: 600;
            font-size: 1.2em;
        }
        
        .provider-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .status-healthy { background: #d4edda; color: #155724; }
        .status-configured { background: #cce5ff; color: #004085; }
        .status-needs-key { background: #fff3cd; color: #856404; }
        .status-local { background: #e2e3e5; color: #383d41; }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #333;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
        }
        
        .btn-success {
            background: #4CAF50;
            color: white;
        }
        
        .btn-success:hover {
            background: #45a049;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-weight: 500;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            animation: fadeInAlert 0.5s ease-in-out;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            animation: fadeInAlert 0.5s ease-in-out;
        }
        
        @keyframes fadeInAlert {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none !important;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .bookmarklet-section {
            grid-column: 1 / -1;
        }
        
        .bookmarklet-code {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 16px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ LLM Bookmarklet Configuration</h1>
            <p>Configure your AI providers and generate your personalized bookmarklet</p>
        </div>
        
        <div id="loading" class="loading">
            <p>Loading configuration...</p>
        </div>
        
        <div id="content" class="hidden">
            <div class="config-grid">
                <!-- Provider Selection -->
                <div class="card">
                    <h2>üîå Active Provider</h2>
                    <div id="providers-list">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Provider Configuration -->
                <div class="card">
                    <h2>‚öôÔ∏è Provider Settings</h2>
                    <div id="provider-config">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Server Status -->
                <div class="card">
                    <h2>üè• Server Health</h2>
                    <div id="server-health">
                        <!-- Populated by JavaScript -->
                    </div>
                    <button class="btn btn-secondary" onclick="checkHealth()">Refresh Status</button>
                </div>
                
                <!-- Quick Actions -->
                <div class="card">
                    <h2>üöÄ Quick Actions</h2>
                    <button class="btn btn-primary" onclick="testProvider()">Test Current Provider</button>
                    <button id="save-settings-btn" class="btn btn-success" onclick="generateBookmarklet()">Generate Customized Bookmarklet</button>
                    <button class="btn btn-secondary" onclick="resetConfig()">Reset to Defaults</button>
                </div>
                
                <!-- Generated Bookmarklet -->
                <div class="card bookmarklet-section">
                    <h2>üîñ Your Bookmarklet</h2>
                    
                    <!-- Important Notice -->
                    <div style="margin-bottom: 20px; padding: 16px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px;">
                        <h4 style="margin-top: 0; color: #856404;">üìå How This Works</h4>
                        <p style="margin: 8px 0; color: #856404;">
                            <strong>The bookmarklet code is unique to your settings.</strong> Your settings are embedded directly in the bookmarklet code.
                        </p>
                        <p style="margin: 8px 0; color: #856404;">
                            When you change settings below and click "Generate Bookmarklet", a new customized bookmarklet is created with your settings built in.
                        </p>
                        <p style="margin: 0; color: #856404;">
                            <strong>Important:</strong> You need to update your browser bookmark each time you change settings. Copy the newly generated bookmarklet and update your bookmark.
                        </p>
                    </div>
                    
                    <!-- Bookmarklet Settings -->
                    <div style="margin-bottom: 20px; padding: 16px; background: #f8f9fa; border-radius: 6px;">
                        <h3 style="margin-bottom: 16px; color: #333;">‚öôÔ∏è Bookmarklet Settings</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div class="form-group">
                                <label>Theme</label>
                                <select id="bookmarklet-theme" onchange="saveUserPreference('theme', this.value)">
                                    <option value="dark">Dark</option>
                                    <option value="light">Light</option>
                                    <option value="blue">Blue</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Server URL</label>
                                <input type="text" id="bookmarklet-server-url" value="http://localhost:4000" 
                                       onchange="saveUserPreference('serverUrl', this.value)" placeholder="Server URL">
                            </div>
                            <div class="form-group">
                                <label>Initial Question (sent automatically with page content)</label>
                                <input type="text" id="bookmarklet-initial-question" 
                                       onchange="saveUserPreference('initialQuestion', this.value)" placeholder="e.g. Give me answers to the multiple choice questions above">
                            </div>
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input type="checkbox" id="bookmarklet-auto-start" 
                                           onchange="saveUserPreference('autoStart', this.checked)" checked>
                                    Auto-start on page load
                                </label>
                            </div>
                        </div>
                        <p style="margin-top: 16px; font-size: 0.9em; color: #666;">
                            These settings are embedded directly in the bookmarklet code. When you click the bookmarklet on any page,
                            it will extract the page content and send it along with your initial question to the selected LLM provider.
                        </p>
                    </div>
                    
                    <p>Copy this bookmarklet and create a new bookmark with it as the URL:</p>
                    <div id="bookmarklet-output" class="bookmarklet-code">
                        Loading bookmarklet...
                    </div>
                    <button class="btn btn-secondary" onclick="copyBookmarklet()">Copy to Clipboard</button>
                </div>
                
                <!-- Current Settings Preview -->
                <div class="card" style="margin-top: 20px;">
                    <h2>üß™ Preview Your Settings</h2>
                    <p>These settings will be embedded directly in your bookmarklet:</p>
                    <div style="padding: 16px; background: #f8f9fa; border-radius: 6px; font-family: monospace; font-size: 13px; position: relative; border: 1px solid #e9ecef;">
                        <div style="position: absolute; top: 10px; right: 10px; font-size: 10px; padding: 3px 6px; background: #e9ecef; border-radius: 4px; color: #6c757d;">
                            preview
                        </div>
                        <pre id="settings-preview" style="white-space: pre-wrap; margin: 0;">{
  "theme": "dark",
  "serverUrl": "http://localhost:4000",
  "initialQuestion": "Give me answers to the multiple choice questions above",
  "autoStart": true
}</pre>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                        After changing settings above, click "Generate Customized Bookmarklet" to create a new bookmarklet with these settings embedded.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentConfig = {};
        const API_BASE = 'http://localhost:4000';
        
        // Initialize the interface
        async function init() {
            try {
                await loadConfig();
                await loadProviders();
                await checkHealth();
                await loadBookmarklet();
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('content').classList.remove('hidden');
                
                // Set up auto-refresh for bookmarklet in development mode
                if (window.location.hostname === 'localhost') {
                    // Every 5 seconds, check for a new bookmarklet version
                    setInterval(loadBookmarklet, 5000);
                    console.log('üî• Development mode: Auto-refresh of bookmarklet enabled');
                }
            } catch (error) {
                showAlert('Failed to load configuration: ' + error.message, 'error');
            }
        }
        
        // Load current configuration
        async function loadConfig() {
            const response = await fetch(`${API_BASE}/config`);
            if (!response.ok) throw new Error('Failed to load config');
            currentConfig = await response.json();
            
            // Update bookmarklet settings from localStorage (these are user preferences, not server config)
            document.getElementById('bookmarklet-theme').value = localStorage.getItem('llm-theme') || 'dark';
            document.getElementById('bookmarklet-server-url').value = localStorage.getItem('llm-serverUrl') || 'http://localhost:4000';
            document.getElementById('bookmarklet-initial-question').value = localStorage.getItem('llm-initialQuestion') || 'Give me answers to the multiple choice questions above. Do not include any other text.';
            document.getElementById('bookmarklet-auto-start').checked = localStorage.getItem('llm-autoStart') !== 'false';
        }
        
        // Load providers list
        async function loadProviders() {
            const response = await fetch(`${API_BASE}/providers`);
            if (!response.ok) throw new Error('Failed to load providers');
            const data = await response.json();
            
            const container = document.getElementById('providers-list');
            container.innerHTML = '';
            
            for (const [name, info] of Object.entries(data.providers)) {
                const isActive = name === data.active;
                const card = document.createElement('div');
                card.className = `provider-card ${isActive ? 'active' : ''}`;
                card.onclick = () => setActiveProvider(name);
                
                card.innerHTML = `
                    <div class="provider-header">
                        <div class="provider-name">${name.charAt(0).toUpperCase() + name.slice(1)}</div>
                        <div class="provider-status status-${info.status}">${info.status}</div>
                    </div>
                    <div style="font-size: 0.9em; color: #666;">
                        Model: ${info.model}<br>
                        Temperature: ${info.temperature}
                    </div>
                `;
                
                container.appendChild(card);
            }
            
            // Load configuration for active provider
            await loadProviderConfig(data.active);
        }
        
        // Load provider-specific configuration
        async function loadProviderConfig(provider) {
            const config = currentConfig.providers[provider];
            if (!config) return;
            
            const container = document.getElementById('provider-config');
            container.innerHTML = `
                <div class="form-group">
                    <label>Model</label>
                    <input type="text" id="model" value="${config.model}" placeholder="e.g., gpt-4o-mini">
                </div>
                <div class="form-group">
                    <label>Temperature</label>
                    <input type="number" id="temperature" value="${config.temperature}" min="0" max="2" step="0.1">
                </div>
                <div class="form-group">
                    <label>Max Tokens</label>
                    <input type="number" id="maxTokens" value="${config.maxTokens}" min="100" max="4000">
                </div>
                ${config.apiKey !== undefined ? `
                <div class="form-group">
                    <label>API Key</label>
                    <input type="password" id="apiKey" value="${config.apiKey}" placeholder="Enter your API key">
                </div>
                ` : ''}
                ${config.baseUrl ? `
                <div class="form-group">
                    <label>Base URL</label>
                    <input type="text" id="baseUrl" value="${config.baseUrl}" placeholder="API base URL">
                </div>
                ` : ''}
                <div class="form-group">
                    <label>System Prompt (instructions for the AI model)</label>
                    <textarea id="systemPrompt" placeholder="Instructions for how the AI should behave...">${config.systemPrompt}</textarea>
                </div>
                <button class="btn btn-primary" onclick="saveProviderConfig('${provider}')">Save Settings</button>
            `;
        }
        
        // Set active provider
        async function setActiveProvider(provider) {
            try {
                const response = await fetch(`${API_BASE}/config`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ activeProvider: provider })
                });
                
                if (!response.ok) throw new Error('Failed to set provider');
                
                showAlert(`Switched to ${provider}`, 'success');
                await loadProviders();
                await checkHealth();
            } catch (error) {
                showAlert('Failed to switch provider: ' + error.message, 'error');
            }
        }
        
        // Save provider configuration
        async function saveProviderConfig(provider) {
            try {
                const settings = {
                    model: document.getElementById('model').value,
                    temperature: parseFloat(document.getElementById('temperature').value),
                    maxTokens: parseInt(document.getElementById('maxTokens').value),
                    systemPrompt: document.getElementById('systemPrompt').value
                };
                
                if (document.getElementById('apiKey')) {
                    settings.apiKey = document.getElementById('apiKey').value;
                }
                
                if (document.getElementById('baseUrl')) {
                    settings.baseUrl = document.getElementById('baseUrl').value;
                }
                
                const response = await fetch(`${API_BASE}/config`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ provider, ...settings })
                });
                
                if (!response.ok) throw new Error('Failed to save settings');
                
                showAlert('Settings saved successfully!', 'success');
                await loadConfig();
                await loadProviders();
            } catch (error) {
                showAlert('Failed to save settings: ' + error.message, 'error');
            }
        }
        
        // Check server health
        async function checkHealth() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                
                const container = document.getElementById('server-health');
                container.innerHTML = `
                    <div style="margin-bottom: 10px;">
                        <strong>Status:</strong> ${data.status}<br>
                        <strong>Active Provider:</strong> ${data.activeProvider}<br>
                        <strong>Provider Status:</strong> ${data.providerStatus}<br>
                        <strong>Last Check:</strong> ${new Date(data.timestamp).toLocaleString()}<br>
                        <strong>Version:</strong> ${data.version}
                    </div>
                `;
            } catch (error) {
                document.getElementById('server-health').innerHTML = `
                    <div style="color: #dc3545;">
                        ‚ùå Server is not responding<br>
                        Make sure the server is running on localhost:4000
                    </div>
                `;
            }
        }
        
        // Test current provider
        async function testProvider() {
            try {
                showAlert('Testing provider...', 'success');
                const response = await fetch(`${API_BASE}/chat-stream`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: 'Test Page',
                        url: 'http://test.com',
                        text: 'This is a test message to verify the provider is working correctly.',
                        question: 'Please respond with "Provider test successful" if you can read this.'
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                showAlert('Provider test successful! ‚úÖ', 'success');
            } catch (error) {
                showAlert('Provider test failed: ' + error.message, 'error');
            }
        }
        
        // Generate a customized bookmarklet with embedded settings
        async function generateBookmarklet() {
            const saveButton = document.getElementById('save-settings-btn');
            const originalText = saveButton.textContent;
            
            try {
                // Show loading state
                saveButton.innerHTML = '<span style="display: inline-block; animation: spin 1s linear infinite;">‚Üª</span> Generating...';
                saveButton.disabled = true;
                
                // Get current form values
                const theme = document.getElementById('bookmarklet-theme').value;
                const serverUrl = document.getElementById('bookmarklet-server-url').value;
                const initialQuestion = document.getElementById('bookmarklet-initial-question').value;
                const autoStart = document.getElementById('bookmarklet-auto-start').checked;
                
                // Call the server endpoint to generate a custom bookmarklet
                const response = await fetch(`${API_BASE}/generate-bookmarklet`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        theme,
                        serverUrl,
                        initialQuestion,
                        autoStart
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to generate bookmarklet');
                }
                
                const data = await response.json();
                
                // Display the generated bookmarklet
                document.getElementById('bookmarklet-output').textContent = data.bookmarklet;
                
                // Create a summary of the settings
                const settingsSummary = [
                    `Theme: ${theme}`,
                    `Server URL: ${serverUrl}`,
                    `Auto-start: ${autoStart ? 'Enabled' : 'Disabled'}`,
                    `Initial question: "${initialQuestion}"`
                ];
                
                // Show success message
                showAlert(`Bookmarklet generated successfully with your settings!\n\n${settingsSummary.join('\n')}\n\nIMPORTANT: Copy the new bookmarklet and update your browser bookmark.`, 'success');
                saveButton.innerHTML = '‚úì Generated!';
                
                // Reset button after 2 seconds
                setTimeout(() => {
                    saveButton.textContent = originalText;
                    saveButton.disabled = false;
                }, 2000);
                
            } catch (error) {
                showAlert('Failed to generate bookmarklet: ' + error.message, 'error');
                saveButton.textContent = originalText;
                saveButton.disabled = false;
            }
        }
        
        // Load the pre-built bookmarklet
        async function loadBookmarklet() {
            try {
                const timestamp = Date.now(); // Add cache-busting timestamp
                const response = await fetch(`/bookmarklet.min.js?t=${timestamp}`);
                if (!response.ok) throw new Error('Failed to load bookmarklet');
                const bookmarklet = await response.text();
                document.getElementById('bookmarklet-output').textContent = bookmarklet;

                // Extract build info from the minified code
                const buildInfoMatch = bookmarklet.match(/BUILD_INFO=\{version:"([^"]+)",buildNumber:"([^"]+)",buildDate:"([^"]+)"\}/);
                if (buildInfoMatch) {
                    const [, version, buildNumber, buildDate] = buildInfoMatch;
                    const buildInfo = document.createElement('div');
                    buildInfo.style.cssText = 'margin-top: 10px; font-size: 0.9em; color: #666;';
                    buildInfo.textContent = `Version ${version} (Build #${buildNumber}) - Built on ${buildDate}`;
                    const outputDiv = document.getElementById('bookmarklet-output');
                    outputDiv.parentNode.insertBefore(buildInfo, outputDiv.nextSibling);
                }
            } catch (error) {
                showAlert('Failed to load bookmarklet: ' + error.message, 'error');
            }
        }


        // Update settings preview when any setting changes
        function saveUserPreference(key, value) {
            // Update preview immediately
            updateSettingsPreview();
            
            // Show feedback for changed settings
            const readableKey = {
                'theme': 'Theme',
                'serverUrl': 'Server URL',
                'initialQuestion': 'Initial question',
                'autoStart': 'Auto-start'
            }[key] || key;
            
            showAlert(`${readableKey} updated! Generate a new bookmarklet to apply this change.`, 'success');
        }
        
        // Update the settings preview display
        function updateSettingsPreview() {
            const settings = {
                theme: document.getElementById('bookmarklet-theme').value,
                serverUrl: document.getElementById('bookmarklet-server-url').value,
                initialQuestion: document.getElementById('bookmarklet-initial-question').value,
                autoStart: document.getElementById('bookmarklet-auto-start').checked
            };
            
            document.getElementById('settings-preview').textContent = JSON.stringify(settings, null, 2);
        }

        // Copy bookmarklet to clipboard
        async function copyBookmarklet() {
            try {
                const code = document.getElementById('bookmarklet-output').textContent;
                await navigator.clipboard.writeText(code);
                showAlert('Bookmarklet copied to clipboard!', 'success');
            } catch (error) {
                showAlert('Failed to copy to clipboard: ' + error.message, 'error');
            }
        }
        
        // Reset configuration
        async function resetConfig() {
            if (!confirm('Are you sure you want to reset all settings to defaults?')) {
                return;
            }
            
            try {
                // This would require a reset endpoint on the server
                showAlert('Reset functionality not implemented yet', 'error');
            } catch (error) {
                showAlert('Failed to reset configuration: ' + error.message, 'error');
            }
        }
        
        // Show alert message
        function showAlert(message, type) {
            // Remove existing alerts
            document.querySelectorAll('.alert').forEach(alert => alert.remove());
            
            const alert = document.createElement('div');
            alert.className = `alert alert-${type === 'error' ? 'error' : 'success'}`;
            
            // Handle multi-line messages
            if (message.includes('\n')) {
                message.split('\n').forEach(line => {
                    const p = document.createElement('p');
                    p.textContent = line;
                    p.style.margin = line ? '4px 0' : '8px 0'; // Add spacing for blank lines
                    alert.appendChild(p);
                });
            } else {
                alert.textContent = message;
            }
            
            // Insert the alert at the top of the content div
            const contentDiv = document.getElementById('content');
            if (contentDiv && contentDiv.firstChild) {
                contentDiv.insertBefore(alert, contentDiv.firstChild);
            } else {
                // Fallback: append to container
                const container = document.querySelector('.container');
                if (container) {
                    container.appendChild(alert);
                } else {
                    // Last resort: append to body
                    document.body.appendChild(alert);
                }
            }
            
            // Auto-remove after 5 seconds for simple messages, 10 seconds for detailed ones
            const timeout = message.includes('\n') ? 10000 : 5000;
            setTimeout(() => alert.remove(), timeout);
        }
        
        // Display current settings from localStorage
        function refreshSettingsDisplay() {
            const settings = {
                theme: localStorage.getItem('llm-theme') || 'dark',
                serverUrl: localStorage.getItem('llm-serverUrl') || 'http://localhost:4000',
                initialQuestion: localStorage.getItem('llm-initialQuestion') || 'Give me answers to the multiple choice questions above. Do not include any other text.',
                autoStart: localStorage.getItem('llm-autoStart') !== 'false'
            };
            
            const display = `Current Bookmarklet Settings:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Theme:           ${settings.theme}
Server URL:      ${settings.serverUrl}
Auto-start:      ${settings.autoStart ? 'Enabled' : 'Disabled'}
Initial Question:
  "${settings.initialQuestion}"
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

When you click the bookmarklet:
1. It will connect to: ${settings.serverUrl}
2. Use the ${settings.theme} theme
3. ${settings.autoStart ? 'Automatically send the initial question above' : 'Wait for you to type a question'}`;
            
            document.getElementById('current-settings-display').textContent = display;
            
            // Update timestamp
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            document.getElementById('settings-timestamp').textContent = timeString;
        }
        
        // Initialize when page loads
        window.addEventListener('load', () => {
            init();
            updateSettingsPreview();
        });
    </script>
</body>
</html> 